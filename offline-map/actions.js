import UTILITIES from"https://www.gteh.top/offline-map/utilities.js";import DATA from"https://www.gteh.top/offline-map/data.js";import DOCUMENT from"https://www.gteh.top/offline-map/document.js";import SETTINGS from"./settings.js";import DRAWING from"https://www.gteh.top/offline-map/drawing.js";import DIRECTIONS from"https://www.gteh.top/offline-map/directions.js";const ACTIONS={onClickStation:e=>{DOCUMENT.onClearSearch(!1),DOCUMENT.clearPanes(!1);const{stations:t,routes:n}=DATA.json[SETTINGS.dimension],{name:o,color:s,zone:l,x:i,z:c}=t[e],a=document.getElementById("station_info");a.removeAttribute("style"),DRAWING.zoomToPoint(i,c);let r="";const d=o.split("|");for(const e in d){const t=d[e];UTILITIES.isCJK(t)?r+="<h1>"+t+"</h1>":r+="<h2>"+t+"</h2>"}document.getElementById("station_name").innerHTML=r,document.getElementById("station_coordinates").innerText=`(${Math.round(i)}, ${Math.round(c)})`,document.getElementById("station_zone").innerText=l,document.getElementById("station_line").style.backgroundColor=UTILITIES.convertColor(s),document.getElementById("station_copy").onclick=(e=>{navigator.clipboard.writeText(`/tp ${i} ~ ${c}`).then(),e.target.innerText="check",setTimeout(()=>e.target.innerText="content_copy",1e3)});const T=document.getElementById("station_routes");T.innerHTML="";const m=[];for(const t in n){const o=n[t],s=o.id;if(!m.includes(s))for(const t in o.stations)if(o.stations[t].split("_")[0]===e){T.append(ACTIONS.getRouteElement(s,o.color,o.name,o.number,o.type,!0,!0,"",!0)),m.push(s);const e=document.createElement("div");e.className="spacer",T.append(e);break}}null!=T.lastChild&&T.removeChild(T.lastChild),a.style.maxHeight=window.innerHeight-80+"px",SETTINGS.selectedStation=e},setupRouteTypeAndDimensionButtons:()=>{const e=DATA.json[SETTINGS.dimension].types,t=e.length<=1;document.getElementById("settings_route_types").style.display=t?"none":"",t?e.forEach(e=>SETTINGS.selectedRouteTypes.push(e)):0===SETTINGS.selectedRouteTypes.filter(t=>e.includes(t)).length&&(SETTINGS.selectedRouteTypes=[e[0]]);for(const t of Object.keys(UTILITIES.routeTypes)){const n=document.getElementById("settings_route_type_"+t);n.className="material-icons clickable "+(SETTINGS.selectedRouteTypes.includes(t)?"selected":""),n.style.display=e.includes(t)?"":"none",n.onclick=(()=>{SETTINGS.selectedRouteTypes.includes(t)?SETTINGS.selectedRouteTypes=SETTINGS.selectedRouteTypes.filter(e=>e!==t):SETTINGS.selectedRouteTypes.push(t),DATA.redraw()})}const n=document.getElementById("settings_dimensions_buttons");n.innerHTML="";let o=0;for(const e in DATA.json)if(DATA.json[e].routes.length>0){const t=document.createElement("span");t.id="toggle_dimension_icon_"+e,t.className="material-icons clickable "+(SETTINGS.dimension===parseInt(e)?"selected":""),t.innerText="public",t.onclick=(()=>{SETTINGS.dimension=parseInt(e),DATA.redraw()}),n.appendChild(t),n.appendChild(document.createTextNode("\n")),o++}document.getElementById("settings_dimensions").style.display=o<=1?"none":""},getStationElement:(e,t,n,o)=>{const s=document.createElement("div");return s.setAttribute("id",o),s.setAttribute("class","clickable"),s.onclick=(()=>ACTIONS.onClickStation(n)),s.innerHTML=(null==e?"":`<span class="station" style="background: ${UTILITIES.convertColor(e)}"></span>`)+`<span class="text">${t.replace(/\|/g," ")}</span>`,s},getRouteElement:(e,t,n,o,s,l,i,c,a)=>{n=n.split("||")[0].replace(/\|/g," "),o=o.split("||")[0].replace(/\|/g," ");const r=document.createElement("div");return r.setAttribute("id",c),r.setAttribute("class","clickable"),r.setAttribute("style","overflow-x: clip"),l||r.setAttribute("style","display: none"),r.onclick=(()=>onClickLine(e,t,a)),r.innerHTML=`<span class="line" style="background: ${UTILITIES.convertColor(i?t:UTILITIES.getColorStyle("--textColorDisabled"))}"></span>`+`<span class="${i?"text":"text_disabled"} material-icons tight">${UTILITIES.routeTypes[s]}</span>`+`<span class="${i?"text":"text_disabled"}">${o}${o?" ":""}${n}</span>`,r},getClosestInterchangeOnRoute:(e,t)=>{const{routes:n,stations:o}=DATA.json[SETTINGS.dimension],s=e.stations;let l=!1;for(let i=0;i<s.length;i++){const c=s[i].split("_")[0];if(l&&(n.some(t=>t.color!==e.color&&t.stations.some(e=>e.split("_")[0]===c))||i===s.length-1))return o[c].name;c===t&&(l=!0)}}},onClickLine=(e,t,n)=>{const o=n||!SETTINGS.selectedRoutes.includes(e);DOCUMENT.onClearSearch(!1),DOCUMENT.clearPanes(!1),document.getElementById("route_stations_tab").style.display="none";const s=DATA.json[SETTINGS.dimension];if(o){const n=s.routes.filter(t=>t.id===e),o=document.getElementById("route_info");o.removeAttribute("style");let l="";const i=n[0].name.split("||")[0].split("|");for(const e in i){const t=i[e];UTILITIES.isCJK(t)?l+="<h1>"+t+"</h1>":l+="<h2>"+t+"</h2>"}document.getElementById("route_name").innerHTML=l,document.getElementById("route_line").style.backgroundColor=UTILITIES.convertColor(t);const c=document.getElementById("route_details");c.innerHTML="",n.forEach(e=>{const{stations:n,durations:o,name:l,number:i,circular:a,type:r}=e;addRouteHeader(c,i,n.length>0?s.stations[n[n.length-1].split("_")[0]].name:"",a,l);const d=document.createElement("div");d.className="station_list";for(let e=0;e<n.length;e++){const l=n[e].split("_")[0];if(d.appendChild(UTILITIES.getDrawStationElement(ACTIONS.getStationElement(null,s.stations[l].name,l,""),0===e?null:t,e===n.length-1?null:t)),e<o.length&&o[e]>0){const n=document.createElement("span");n.innerHTML=UTILITIES.formatTime(o[e]/20),d.appendChild(UTILITIES.getDrawLineElement("schedule",n,t))}}c.appendChild(d);const T=document.createElement("div");T.className="spacer padded",c.append(T),SETTINGS.selectedRouteTypes.includes(r)||SETTINGS.selectedRouteTypes.push(r)}),null!=c.lastChild&&c.removeChild(c.lastChild),o.style.maxHeight=window.innerHeight-80+"px",UTILITIES.removeFromArray(SETTINGS.selectedRoutes,e),SETTINGS.selectedRoutes.push(e)}else UTILITIES.removeFromArray(SETTINGS.selectedRoutes,e);DIRECTIONS.drawDirectionsRoute([],{}),DATA.redraw()},addRouteHeader=(e,t,n,o,s)=>{const l=document.createElement("h3");l.innerHTML=t.replace(/\|/g," ")+`<span class="material-icons tight">${""===o?"chevron_right":"cw"===o?"rotate_right":"rotate_left"}</span>`+n.replace(/\|/g," "),e.appendChild(l);const i=s.split("||");if(i.length>1){const t=document.createElement("h4");t.innerText=i[1].replace(/\|/g," "),e.appendChild(t)}};document.getElementById("route_stations_tab").onclick=(()=>onSelectDelaysTab(!1));export default ACTIONS;